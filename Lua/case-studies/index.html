
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://pcsx-redux.consoledev.net/Lua/case-studies/">
      
      
        <link rel="prev" href="../binary/">
      
      
        <link rel="next" href="../../openbios/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.4">
    
    
      
        <title>Case studies - PCSX-Redux</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.240905d7.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#case-studies" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PCSX-Redux" class="md-header__button md-logo" aria-label="PCSX-Redux" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PCSX-Redux
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Case studies
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/grumpycoders/pcsx-redux/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PCSX-Redux" class="md-nav__button md-logo" aria-label="PCSX-Redux" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    PCSX-Redux
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/grumpycoders/pcsx-redux/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../menus/" class="md-nav__link">
        PCSX-Redux menus
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../compiling/" class="md-nav__link">
        Compiling PCSX-Redux
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../cli_flags/" class="md-nav__link">
        Command Line Flags
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Debugging
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Debugging
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Debugging/introduction/" class="md-nav__link">
        Debugging with PCSX-Redux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Debugging/gdb-server/" class="md-nav__link">
        GDB server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Debugging/ghidra/" class="md-nav__link">
        Connecting Ghidra to PCSX-Redux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Debugging/misc-features/" class="md-nav__link">
        Misc Features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Debugging/vram-viewer/" class="md-nav__link">
        VRAM viewer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Debugging/gpu-logger/" class="md-nav__link">
        GPU Logger
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../mips_api/" class="md-nav__link">
        Mips API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../web_server/" class="md-nav__link">
        Web server
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          Lua
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Lua
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../libraries/" class="md-nav__link">
        Loaded libraries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../redux-basics/" class="md-nav__link">
        Redux basic API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rendering/" class="md-nav__link">
        Rendering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../file-api/" class="md-nav__link">
        File API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../web-server/" class="md-nav__link">
        Webserver Lua API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../memory-and-registers/" class="md-nav__link">
        Memory and registers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../events/" class="md-nav__link">
        Events
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../breakpoints/" class="md-nav__link">
        Breakpoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../assembler/" class="md-nav__link">
        Inline assembler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../binary/" class="md-nav__link">
        Handling of PSX binaries
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Case studies
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Case studies
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spyro-year-of-the-dragon" class="md-nav__link">
    Spyro: Year of the Dragon
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crash-bandicoot" class="md-nav__link">
    Crash Bandicoot
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crash-bandicoot-using-conditional-breakpoints" class="md-nav__link">
    Crash Bandicoot - Using Conditional BreakPoints
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-references" class="md-nav__link">
    More references
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../openbios/" class="md-nav__link">
        Openbios
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spyro-year-of-the-dragon" class="md-nav__link">
    Spyro: Year of the Dragon
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crash-bandicoot" class="md-nav__link">
    Crash Bandicoot
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crash-bandicoot-using-conditional-breakpoints" class="md-nav__link">
    Crash Bandicoot - Using Conditional BreakPoints
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-references" class="md-nav__link">
    More references
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="case-studies">Case studies</h1>
<h2 id="spyro-year-of-the-dragon">Spyro: Year of the Dragon</h2>
<p>By looking up some of the <a href="https://www.cheatcc.com/psx/codes/spyroyotd.html">gameshark codes</a> for this game, we can determine the following memory addresses:</p>
<ul>
<li><code>0x8007582c</code> is the number of lives.</li>
<li><code>0x80078bbc</code> is the health of Spyro.</li>
<li><code>0x80075860</code> is the number of unspent jewels available to the player.</li>
<li><code>0x80075750</code> is the number of dragons Spyro released so far.</li>
</ul>
<p>With this, we can build a small UI to visualize and manipulate these values in real time:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">-- Declare a helper function with the following arguments:</span>
<span class="c1">--   mem: the ffi object representing the base pointer into the main RAM</span>
<span class="c1">--   address: the address of the uint32_t to monitor and mutate</span>
<span class="c1">--   name: the label to display in the UI</span>
<span class="c1">--   min, max: the minimum and maximum values of the slider</span>
<span class="c1">--</span>
<span class="c1">-- This function is local as to not pollute the global namespace.</span>
<span class="kd">local</span> <span class="kr">function</span> <span class="nf">doSliderInt</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">min</span><span class="p">,</span> <span class="n">max</span><span class="p">)</span>
  <span class="c1">-- Clamping the address to the actual memory space, essentially</span>
  <span class="c1">-- removing the upper bank address using a bitmask. The result</span>
  <span class="c1">-- will still be a normal 32-bits value.</span>
  <span class="n">address</span> <span class="o">=</span> <span class="n">bit</span><span class="p">.</span><span class="n">band</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mh">0x1fffff</span><span class="p">)</span>
  <span class="c1">-- Computing the FFI pointer to the actual uint32_t location.</span>
  <span class="c1">-- The result will be a new FFI pointer, directly into the emulator&#39;s</span>
  <span class="c1">-- memory space, hopefully within normal accessible bounds. The</span>
  <span class="c1">-- resulting type will be a cdata[uint8_t*].</span>
  <span class="kd">local</span> <span class="n">pointer</span> <span class="o">=</span> <span class="n">mem</span> <span class="o">+</span> <span class="n">address</span>
  <span class="c1">-- Casting this pointer to a proper uint32_t pointer.</span>
  <span class="n">pointer</span> <span class="o">=</span> <span class="n">ffi</span><span class="p">.</span><span class="n">cast</span><span class="p">(</span><span class="s1">&#39;uint32_t*&#39;</span><span class="p">,</span> <span class="n">pointer</span><span class="p">)</span>
  <span class="c1">-- Reading the value in memory</span>
  <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="n">pointer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="c1">-- Drawing the ImGui slider</span>
  <span class="kd">local</span> <span class="n">changed</span>
  <span class="n">changed</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">imgui</span><span class="p">.</span><span class="n">SliderInt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">min</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="s1">&#39;%d&#39;</span><span class="p">)</span>
  <span class="c1">-- The ImGui Lua binding will first return a boolean indicating</span>
  <span class="c1">-- if the user moved the slider. The second return value will be</span>
  <span class="c1">-- the new value of the slider if it changed. Therefore we can</span>
  <span class="c1">-- reassign the pointer accordingly.</span>
  <span class="kr">if</span> <span class="n">changed</span> <span class="kr">then</span> <span class="n">pointer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="kr">end</span>
<span class="kr">end</span>

<span class="c1">-- Utilizing the DrawImguiFrame periodic function to draw our UI.</span>
<span class="c1">-- We are declaring this function global so the emulator can</span>
<span class="c1">-- properly call it periodically.</span>
<span class="kr">function</span> <span class="nf">DrawImguiFrame</span><span class="p">()</span>
  <span class="c1">-- This is typical ImGui paradigm to display a window using</span>
  <span class="c1">-- the safe mode. This will ensure that the window is properly</span>
  <span class="c1">-- closed even if an exception is thrown during the rendering</span>
  <span class="c1">-- of the window.</span>
  <span class="n">imgui</span><span class="p">.</span><span class="n">safe</span><span class="p">.</span><span class="n">Begin</span><span class="p">(</span><span class="s1">&#39;Spyro internals&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="c1">-- Grabbing the pointer to the main RAM, to avoid calling</span>
    <span class="c1">-- the function for every pointer we want to change.</span>
    <span class="c1">-- Note: it&#39;s not a good idea to hold onto this value between</span>
    <span class="c1">-- calls to the Lua VM, as the memory can potentially move</span>
    <span class="c1">-- within the emulator&#39;s memory space.</span>
    <span class="kd">local</span> <span class="n">mem</span> <span class="o">=</span> <span class="n">PCSX</span><span class="p">.</span><span class="n">getMemPtr</span><span class="p">()</span>

    <span class="c1">-- Now calling our helper function for each of our pointer.</span>
    <span class="n">doSliderInt</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x8007582c</span><span class="p">,</span> <span class="s1">&#39;Lives&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">doSliderInt</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x80078bbc</span><span class="p">,</span> <span class="s1">&#39;Health&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">doSliderInt</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x80075860</span><span class="p">,</span> <span class="s1">&#39;Jewels&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">65000</span><span class="p">)</span>
    <span class="n">doSliderInt</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x80075750</span><span class="p">,</span> <span class="s1">&#39;Dragons&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
  <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div></td></tr></table></div>
<p>You can see this code in action <a href="https://youtu.be/WeHXTLDy5rs">in this demo video</a>.</p>
<h2 id="crash-bandicoot">Crash Bandicoot</h2>
<p>Using exactly the same as above, we can repeat the same sort of cheats for Crash Bandicoot. Note that when the CPU is being emulated, the <code>DrawImguiFrame</code> function will be called at least when the emulation is issuing a vsync event. This means that cheat codes that regularly write to memory during vsync can be applied naturally.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">local</span> <span class="kr">function</span> <span class="nf">crash_Checkbox</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>
  <span class="n">address</span> <span class="o">=</span> <span class="n">bit</span><span class="p">.</span><span class="n">band</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mh">0x1fffff</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">pointer</span> <span class="o">=</span> <span class="n">mem</span> <span class="o">+</span> <span class="n">address</span>
  <span class="n">pointer</span> <span class="o">=</span> <span class="n">ffi</span><span class="p">.</span><span class="n">cast</span><span class="p">(</span><span class="s1">&#39;uint32_t*&#39;</span><span class="p">,</span> <span class="n">pointer</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">changed</span>
  <span class="kd">local</span> <span class="n">check</span>
  <span class="kd">local</span> <span class="n">tempvalue</span> <span class="o">=</span> <span class="n">pointer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="kr">if</span> <span class="n">tempvalue</span> <span class="o">==</span> <span class="n">original</span> <span class="kr">then</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">false</span> <span class="kr">end</span>
  <span class="kr">if</span> <span class="n">tempvalue</span> <span class="o">==</span> <span class="n">value</span> <span class="kr">then</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">true</span> <span class="kr">else</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">false</span> <span class="kr">end</span>
  <span class="n">changed</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="n">imgui</span><span class="p">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">check</span><span class="p">)</span>
  <span class="kr">if</span> <span class="n">check</span> <span class="kr">then</span> <span class="n">pointer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="kr">else</span> <span class="n">pointer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">original</span> <span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">DrawImguiFrame</span><span class="p">()</span>
  <span class="n">imgui</span><span class="p">.</span><span class="n">safe</span><span class="p">.</span><span class="n">Begin</span><span class="p">(</span><span class="s1">&#39;Crash Bandicoot Mods&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">mem</span> <span class="o">=</span> <span class="n">PCSX</span><span class="p">.</span><span class="n">getMemPtr</span><span class="p">()</span>
    <span class="n">crash_Checkbox</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x80027f9a</span><span class="p">,</span> <span class="s1">&#39;Neon Crash&#39;</span><span class="p">,</span> <span class="mh">0x2400</span><span class="p">,</span> <span class="mh">0x100c00</span><span class="p">)</span>
    <span class="n">crash_Checkbox</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x8001ed5a</span><span class="p">,</span> <span class="s1">&#39;Unlimited Time Aku&#39;</span><span class="p">,</span> <span class="mh">0x0003</span><span class="p">,</span> <span class="mh">0x3403</span><span class="p">)</span>
    <span class="n">crash_Checkbox</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x8001dd0c</span><span class="p">,</span> <span class="s1">&#39;Walk Mid-Air&#39;</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x8e0200c8</span><span class="p">)</span>
    <span class="n">crash_Checkbox</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x800618ec</span><span class="p">,</span> <span class="s1">&#39;99 Lives at Map&#39;</span><span class="p">,</span> <span class="mh">0x6300</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">)</span>
    <span class="n">crash_Checkbox</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x80061949</span><span class="p">,</span> <span class="s1">&#39;Unlock all Levels&#39;</span><span class="p">,</span> <span class="mh">0x0020</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span>
    <span class="n">crash_Checkbox</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x80019276</span><span class="p">,</span> <span class="s1">&#39;Disable Draw Level&#39;</span><span class="p">,</span> <span class="mh">0x20212400</span><span class="p">,</span> <span class="mh">0x20210c00</span><span class="p">)</span>
  <span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div></td></tr></table></div>
<h2 id="crash-bandicoot-using-conditional-breakpoints">Crash Bandicoot - Using Conditional BreakPoints</h2>
<p>This example will showcase using the BreakPoints and Assembly UI, as well as using the Lua console to manipulate breakpoints.</p>
<p>Crash Bandicoot 1 has several modes of execution. These modes tell the game what to do, such as which level to load into, or to load back into the map. These modes are passed to the main game loop routine as an argument. Due to this, manually manipulating memory at the right time with the correct value to can be tricky to ensure the desired result.</p>
<p>The game modes are <a href="https://github.com/wurlyfox/crashutils/blob/da21a40a3e8928762eb58b551a54a6e6f8ed73e9/doc/crash/disasm_guide.txt#L131">listed here</a>.</p>
<p>In Crash 1, there is a level that was included in the game but cut from the final level selection due to difficulty, 'Stormy Ascent'. This level can be accessed only by manipulating the game mode value that is passed to the main game routine. There is a gameshark code that points us to the memory location and value that needs to be written in order to set the game mode to the Story Ascent level.</p>
<ul>
<li><code>30011DB0 0022</code> - This is telling us to write the value 0x0022 at memory location <code>0x8001db0</code> 0x0022 is the value of the Stormy Ascent level we want to play.</li>
</ul>
<p>The issue is that GameShark uses a hook to achieve setting this value at the correct time. We will set up a breakpoint to see where the main game routine is.</p>
<p>Setting the breakpoint can be done through the Breakpoint UI or in the Lua console. There is a link to a video at the bottom of the article showing the entire procedure.</p>
<p>Breakpoints can alternatively be set through the Lua console. In PCSX-Redux top menu, click Debug → Show Lua Console</p>
<p>We are going to add a breakpoint to pause execution when memory address 0x8001db0 is read. This will show where the main game loop is located in memory.</p>
<p>In the Lua console, paste the following hit enter.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">bp</span> <span class="o">=</span> <span class="n">PCSX</span><span class="p">.</span><span class="n">addBreakpoint</span><span class="p">(</span><span class="mh">0x80011db0</span><span class="p">,</span> <span class="s1">&#39;Read&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Find main loop&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>You should see where the breakpoint was added in the Lua console, as well as in the Breakpoints UI. Note that we need to assign the result of the function to a variable to avoid garbage collection.</p>
<p>Now open Debug → Show Assembly</p>
<p>Start the emulator with Crash Bandicoot 1 SCUS94900</p>
<p>Right before the BIOS screen ends, the emulator should pause. In the assembly window we can see a yellow arrow pointing to <code>0x80042068</code>. We can see this is a <code>lw</code> instruction that is reading a value from <code>0x8001db0</code>. This is the main game loop reading the game mode value from memory!</p>
<p>Now that we know where the main game loop is located in memory, we can set a conditional breakpoint to properly set the game mode value when the main game routine is executed.</p>
<p>This breakpoint will be triggered when the main game loop at <code>0x80042068</code> is executed, and ensure the value at <code>0x80011db0</code> is set to <code>0x0022</code></p>
<p>In the Lua console, paste the following and hit enter.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">bp</span> <span class="o">=</span> <span class="n">PCSX</span><span class="p">.</span><span class="n">addBreakpoint</span><span class="p">(</span><span class="mh">0x80042068</span><span class="p">,</span> <span class="s1">&#39;Exec&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Stormy Ascent&#39;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
  <span class="n">PCSX</span><span class="p">.</span><span class="n">getMemPtr</span><span class="p">()[</span><span class="mh">0x11db0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x22</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>We can now disable/remove our Read breakpoint using the Breakpoints UI, and restart the game. Emulation → Hard Reset</p>
<p>If the Emulator status shows Idle, click Emulation → Start</p>
<p>Once the game starts, instead of loading into the main menu, you should load directly into the Stormy Ascent level.</p>
<p>You can see this in action <a href="https://youtu.be/BczviiXUYOY">in this demo video</a>.</p>
<h2 id="more-references">More references</h2>
<p>Here's some projects using PCSX-Redux' Lua scripting capabilities, which can be used as references:</p>
<ul>
<li><a href="https://github.com/NDR008/TensorFlowPSX">https://github.com/NDR008/TensorFlowPSX</a></li>
<li><a href="https://github.com/Kuumba123/TeheManX4_Editor">https://github.com/Kuumba123/TeheManX4_Editor</a></li>
<li><a href="https://github.com/notdodgeball/vagrant-story-lua-script">https://github.com/notdodgeball/vagrant-story-lua-script</a></li>
<li><a href="https://github.com/johnbaumann/lua-pio-cart">https://github.com/johnbaumann/lua-pio-cart</a></li>
<li><a href="https://github.com/FoxdieTeam/mgs_reversing">https://github.com/FoxdieTeam/mgs_reversing</a></li>
<li><a href="https://github.com/kiletic/tekken3-ai">https://github.com/kiletic/tekken3-ai</a></li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.19047be9.min.js"></script>
      
    
  </body>
</html>
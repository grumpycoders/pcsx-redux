name: Linux CI

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: grumpycoders/pcsx-redux-build:latest
      env:
        TEST_RESULTS: /tmp/test-results
        APPCENTER_ACCESS_TOKEN: ${{ secrets.LINUX_APPCENTER_ACCESS_TOKEN }}
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: recursive
          set-safe-directory: true
      - uses: n1hility/cancel-previous-runs@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Packaging
        run: |
      - name: Deploy
        run: |
          . /usr/local/nvm/nvm.sh
          git config --global --add safe.directory /__w/pcsx-redux/pcsx-redux
          git rev-parse HEAD | cut -c 1-8
          export BUILD=`git rev-parse HEAD | cut -c 1-8`
          echo "foo: $BUILD"
